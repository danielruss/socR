<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Built on tidyverse • socR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Built on tidyverse">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">socR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Built_on_tidyverse.html">Built on tidyverse</a></li>
    <li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started with socR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Built on tidyverse</h1>
                        <h4 data-toc-skip class="author">Daniel
Russ</h4>
            
            <h4 data-toc-skip class="date">2025-07-07</h4>
      

      <div class="d-none name"><code>Built_on_tidyverse.Rmd</code></div>
    </div>

    
    
<p>Occupational data is often nice and tabular, but sometimes you have
data that is not so nice. If we have soccer results, we may only want to
look at the top 3, and we may have 3 human coder results. Instead of
using having columns soc2010_1,score_1,soc2010_2,score_2…
soc2010_n,score_n you may want to simply using List columns. This is
supported by data.frame and tibble. This allows us to put vectors as
values. One drawback is the you need to map when you mutate instead of
having a simple function.</p>
<p>If your are using socR, codingsystem and xwalks are built on top of
tibbles. I implemented some of the dplyr verbs on codingsystems and
crosswalk, but if a verb does not exist you can get the underlying
tibble using as_tibble().</p>
<p>Lets make some fake data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://danielruss.github.io/socR/">socR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"job-1"</span>,<span class="st">"job-2"</span>,<span class="st">"job-3"</span>,<span class="st">"job-4"</span><span class="op">)</span>,</span>
<span>                  JobTitle<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tv repairman"</span>,<span class="st">"home plumber"</span>,<span class="st">"fire fighter"</span>,<span class="st">"President"</span><span class="op">)</span>,</span>
<span>                  JobTask <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fix tvs"</span>,<span class="st">"various plumbing work"</span>,<span class="st">"put out fires, EMS"</span>,<span class="st">"owns and operates"</span><span class="op">)</span>,</span>
<span>                  soc2010_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"49-2097"</span>,<span class="st">"47-2152"</span>,<span class="st">"33-2011"</span>,<span class="st">"11-1021"</span><span class="op">)</span>,</span>
<span>                  soc2010_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"49-9099"</span>,<span class="st">"47-3015"</span>,<span class="st">"33-1021"</span>,<span class="st">"11-1011"</span><span class="op">)</span>,</span>
<span>                  soc2010_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"49-9031"</span>,<span class="st">"49-9071"</span>,<span class="st">"55-3019"</span>,<span class="st">"11-9021"</span><span class="op">)</span>,</span>
<span>                  score_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9199</span>,<span class="fl">0.9866</span>,<span class="fl">0.9903</span>,<span class="fl">0.8812</span><span class="op">)</span>,</span>
<span>                  score_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0888</span>,<span class="fl">0.1003</span>,<span class="fl">0.0132</span>,<span class="fl">0.7980</span><span class="op">)</span>,</span>
<span>                  score_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0159</span>,<span class="fl">0.0337</span>,<span class="fl">0.0113</span>,<span class="fl">0.2286</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 9</span></span></span>
<span><span class="co">#&gt;   id    JobTitle   JobTask soc2010_1 soc2010_2 soc2010_3 score_1 score_2 score_3</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repair… fix tvs 49-2097   49-9099   49-9031     0.920  0.088<span style="text-decoration: underline;">8</span>  0.015<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plum… variou… 47-2152   47-3015   49-9071     0.987  0.100   0.033<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire figh… put ou… 33-2011   33-1021   55-3019     0.990  0.013<span style="text-decoration: underline;">2</span>  0.011<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President  owns a… 11-1021   11-1011   11-9021     0.881  0.798   0.229</span></span></code></pre></div>
<p>Let combine the soccer results and the soccer scores.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>soc2010_soccer<span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"soc2010_"</span><span class="op">)</span><span class="op">)</span>,\<span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>         scores_soccer <span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"score_"</span><span class="op">)</span><span class="op">)</span>,\<span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span><span class="op">:</span><span class="va">JobTask</span>,<span class="va">soc2010_soccer</span>,<span class="va">scores_soccer</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   id    JobTitle     JobTask               soc2010_soccer scores_soccer</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repairman fix tvs               <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plumber various plumbing work <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire fighter put out fires, EMS    <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President    owns and operates     <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span></span></span></code></pre></div>
<p>Now lets make some fake human coder results</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"job-1"</span>,<span class="st">"job-2"</span>,<span class="st">"job-3"</span>,<span class="st">"job-4"</span><span class="op">)</span>,</span>
<span>                JobTitle<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tv repairman"</span>,<span class="st">"home plumber"</span>,<span class="st">"fire fighter"</span>,<span class="st">"President"</span><span class="op">)</span>,</span>
<span>                JobTask <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fix tvs"</span>,<span class="st">"various plumbing work"</span>,<span class="st">"put out fires, EMS"</span>,<span class="st">"owns and operates"</span><span class="op">)</span>,</span>
<span>                soc2010_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"49-2097"</span>,<span class="st">"47-2152"</span>,<span class="st">"33-2011"</span>,<span class="st">"11-1011"</span><span class="op">)</span>,</span>
<span>                soc2010_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"46-130"</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>,</span>
<span>                soc2010_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">coder</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   id    JobTitle     JobTask               soc2010_1 soc2010_2 soc2010_3</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repairman fix tvs               49-2097   <span style="color: #949494;">""</span>        <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plumber various plumbing work 47-2152   <span style="color: #949494;">"</span>46-130<span style="color: #949494;">"</span>  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire fighter put out fires, EMS    33-2011    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President    owns and operates     11-1011    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Lets make sure that the human coder gave real codes. The socR package
comes with a predefined function is_valid_6digit_soc2010, let’s not use
it but reinvent it. We will use the soc2010 coding system that comes
with socR</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_valid_6digit_soc2010</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/valid_code.html">valid_code</a></span><span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">soc2010_all</span>,<span class="va">Level</span><span class="op">==</span><span class="fl">6</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">coder</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"soc2010_"</span><span class="op">)</span><span class="op">)</span>,<span class="va">is_valid_6digit_soc2010</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   id    JobTitle     JobTask               soc2010_1 soc2010_2 soc2010_3</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repairman fix tvs               TRUE      FALSE     FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plumber various plumbing work TRUE      FALSE     FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire fighter put out fires, EMS    TRUE      FALSE     FALSE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President    owns and operates     TRUE      FALSE     FALSE</span></span></code></pre></div>
<p>Lets combine all the results so that the codes are valid</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coder</span> <span class="op">&lt;-</span> <span class="va">coder</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  soc2010_coder<span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"soc2010_"</span><span class="op">)</span><span class="op">)</span>,\<span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">codes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">codes</span> <span class="op">=</span> <span class="va">codes</span><span class="op">[</span><span class="fu"><a href="../reference/valid_code.html">is_valid_6digit_soc2010</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">soc2010_coder</span><span class="op">)</span></span></code></pre></div>
<p>Now we can join the soccer results and the coder results.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">results</span>,<span class="va">coder</span>,by<span class="op">=</span><span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">combined_results</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   id    JobTitle     JobTask          soc2010_soccer scores_soccer soc2010_coder</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repairman fix tvs          <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plumber various plumbin… <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire fighter put out fires, … <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President    owns and operat… <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span></span></span></code></pre></div>
<p>Lets see how soccer did with these jobs. Since there are 3 SOCcer
results the rank can be 1,2,3,or 4+. Let’s make this an ordered factor
with levels “1”,“2”,“3”,“4+”</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factor_levels</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">factor_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="st">"4+"</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">combined_results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rank<span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_int</a></span><span class="op">(</span><span class="va">soc2010_coder</span>,<span class="va">soc2010_soccer</span>,\<span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>         rank<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">rank</span>,<span class="va">factor_levels</span>,<span class="va">factor_labels</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dta</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">#&gt;   id    JobTitle     JobTask    soc2010_soccer scores_soccer soc2010_coder rank </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job-1 tv repairman fix tvs    <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>     1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> job-2 home plumber various p… <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>     1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> job-3 fire fighter put out f… <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>     1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> job-4 President    owns and … <span style="color: #949494;">&lt;chr [3]&gt;</span>      <span style="color: #949494;">&lt;dbl [3]&gt;</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>     2</span></span>
<span><span class="va">dta</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">rank</span>,y<span class="op">=</span><span class="va">pct</span>,group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Percent Agreement"</span>,limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"SOCcerNET: Agreement with Expert Coding at different ranks"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"This is an example, not indicative of real data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Built_on_tidyverse_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>By default SOCcer returns the top-10 scoring codes, in this example
only 3 are given and for the 4 jobs all are successfully coded by
soc2010_1 or soc2010_2 (rank=1 or rank=2). From this small and very easy
to code set of jobs, you can see that SOCcer agreed with the experts 75%
at the most detailed level and 100 of the jobs agreed if you include two
codes (Do not expect results this good.).<br>
There is no point in continuing the line beyond 2.</p>
<p>I hope you see how we can use the list columns and the purrr::map
family to handle the case of multiple results. If you do not like map,
you may be able to use <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">dplyr::rowwise</a></code> to handle the
lists.</p>
<p>When you are ready to write out the data, you probably don’t want to
use csv format. I suggest using <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/read_json.html" class="external-link">jsonlite::write_json</a></code> or if
you are adventurous use <code>arrow::write_feather</code></p>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel E. Russ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
